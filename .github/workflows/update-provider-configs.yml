name: Update Provider Configs with Claude

on:
  schedule:
    - cron: '0 2 * * 0'
  workflow_dispatch:

jobs:
  update-configs:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-node@v3
      with:
        node-version: '18'
        
    - name: Update configs with Claude
      env:
        ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
      run: |
        curl -X POST https://api.anthropic.com/v1/messages \
          -H "x-api-key: $ANTHROPIC_API_KEY" \
          -H "anthropic-version: 2023-06-01" \
          -H "content-type: application/json" \
          -d '{
            "model": "claude-3-5-sonnet-20241022",
            "max_tokens": 4000,
            "messages": [
              {
                "role": "user", 
                "content": "Generate a complete providerConfigs.js file for AI.duino with latest models and prices. Include CONFIG_VERSION with today in DDMMYY format. Include all providers: Claude, ChatGPT, Gemini, Groq, Mistral, Perplexity, Cohere. Use JavaScript module.exports format."
              }
            ]
          }' > response.json
          
        cat response.json
        
    - name: Test step
      run: echo "Workflow running"
