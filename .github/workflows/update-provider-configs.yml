name: Update Provider Configs

on:
  workflow_dispatch:
  schedule:
    - cron: '0 2 * * 0'  # Every Sunday 02:00 UTC
  push:
    paths:
      - '.github/workflows/update-provider-configs.yml'

permissions:
  contents: write

jobs:
  update-configs:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Ensure target directory exists
        run: |
          mkdir -p aiduino/extension/out/config

      - name: Download latest providerConfigs.js
        run: |
          set -euo pipefail
          curl -fsSL 'https://raw.githubusercontent.com/NikolaiRadke/AI.duino/refs/heads/main/aiduino/extension/out/config/providerConfigs.js' -o aiduino/extension/out/config/providerConfigs.js.new
          if ! test -f aiduino/extension/out/config/providerConfigs.js || ! cmp -s aiduino/extension/out/config/providerConfigs.js.new aiduino/extension/out/config/providerConfigs.js; then
            mv aiduino/extension/out/config/providerConfigs.js.new aiduino/extension/out/config/providerConfigs.js
            echo "UPDATED=1" >> "$GITHUB_ENV"
            echo "Config updated."
          else
            echo "No changes in providerConfigs.js"
          fi

      - name: Commit and push if changed
        if: env.UPDATED == '1'
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add aiduino/extension/out/config/providerConfigs.js
          git commit -m "chore: update providerConfigs.js"
          git push
